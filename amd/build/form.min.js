define("mod_videolesson/form",["exports","core/notification","core/str","mod_videolesson/table"],(function(_exports,_notification,Str,_table){var obj;
/**
   * Form functionality for videolesson plugin
   *
   * @module     mod_videolesson/form
   * @copyright  2022-2026 BitKea Technologies LLP
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_notification=(obj=_notification)&&obj.__esModule?obj:{default:obj},Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str);let restrict=!1,awsdependent=["aws","upload"];_exports.init=params=>{restrict=params.restrict;const contenthash=document.getElementById("id_contenthash"),sourceElement=document.getElementById("id_source"),galleryContainer=document.getElementById("video_gallery_container"),completionunlockedElement=document.getElementsByName("completionunlocked")[0],completionunlocked=completionunlockedElement||null,instance=document.getElementsByName("instance")[0],videourl=document.getElementsByName("videourl")[0];let originalValueUrl=videourl.value,originalValue=sourceElement.value,originalValueContenthash=contenthash.value,notified=!1;(0,_table.initTable)();document.getElementById("videolist").addEventListener("click",(function(event){console.log("table click",event);const clickedRow=event.target.closest("tbody tr");console.log("clickedRow",clickedRow),clickedRow&&(originalValueContenthash&&originalValueContenthash!=clickedRow.getAttribute("data-contenthash")?changeVideoConfirm(clickedRow,changeVideo):changeVideo(clickedRow))}));const changeVideoConfirm=function(clickedRowOrEvent,saveCallback){let cancelCallback=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,cancelParam=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const isRow=clickedRowOrEvent&&1===clickedRowOrEvent.nodeType,isEvent=clickedRowOrEvent&&clickedRowOrEvent.target,row=isRow?clickedRowOrEvent:null,event=isEvent?clickedRowOrEvent:null;if(event&&restrict&&awsdependent.includes(event.target.value))return noconfigConfirm(),void(sourceElement.value=originalValue);!notified&&instance.value?Str.get_strings([{key:"modform:videochange:title",component:"mod_videolesson"},{key:"modform:videochange:content",component:"mod_videolesson"},{key:"modform:videochange:yes",component:"mod_videolesson"},{key:"modform:videochange:cancel",component:"mod_videolesson"}]).then((function(strings){_notification.default.confirm(strings[0],strings[1],strings[2],strings[3],(()=>{notified=!0,saveCallback(row||clickedRowOrEvent)}),(()=>{null!==cancelCallback&&cancelCallback(cancelParam)}))})).catch(_notification.default.exception):saveCallback(row||clickedRowOrEvent)},noconfigConfirm=()=>{Str.get_strings([{key:"modform:noconfig:alert:title",component:"mod_videolesson"},{key:"modform:noconfig:alert:content",component:"mod_videolesson"},{key:"modform:noconfig:alert:button",component:"mod_videolesson"}]).then((function(strings){_notification.default.alert(strings[0],strings[1],strings[2])})).catch(_notification.default.exception)},changeVideo=clickedRow=>{console.log("changeVideo",clickedRow);const row=clickedRow&&clickedRow.nodeType?clickedRow:clickedRow&&clickedRow.currentTarget?clickedRow.currentTarget:null;if(!row)return void console.error("changeVideo: Invalid row element",clickedRow);const rowContenthash=row.getAttribute("data-contenthash");completionunlocked&&originalValueContenthash!=rowContenthash&&(completionunlocked.value=1),contenthash.value=rowContenthash;for(var rows=document.getElementById("videolist").getElementsByTagName("tr"),i=0;i<rows.length;i++)rows[i].classList.remove("selected");row.classList.add("selected")},changeUrlSave=()=>{},changeUrlCancel=original=>{videourl.value=original},SetselectOriginalVale=original=>{sourceElement.value=original,toggleContainerVisibility()},toggleContainerVisibility=()=>{let toShowElementIds=[],toHideElementIds=[];switch(sourceElement.value){case"upload":toShowElementIds=["fitem_id_newvideo","fitem_id_thumbnail"],toHideElementIds=["fitem_id_videourl","fitem_id_embedcode"],params.restrict&&toShowElementIds.push("fitem_id_missingconfig"),galleryContainer.classList.toggle("d-none",!0);break;case"aws":toShowElementIds=["video_gallery_container","fitem_id_thumbnail"],toHideElementIds=["fitem_id_newvideo","fitem_id_videourl","fitem_id_embedcode"],params.restrict&&toShowElementIds.push("fitem_id_missingconfig"),galleryContainer.classList.toggle("d-none",!1);break;case"external":toShowElementIds=["fitem_id_videourl"],toHideElementIds=["fitem_id_newvideo","video_gallery_container","fitem_id_thumbnail","fitem_id_embedcode"],params.restrict&&toHideElementIds.push("fitem_id_missingconfig"),galleryContainer.classList.toggle("d-none",!0);break;case"embed":toShowElementIds=["fitem_id_embedcode"],toHideElementIds=["fitem_id_newvideo","video_gallery_container","fitem_id_thumbnail","fitem_id_videourl"],params.restrict&&toHideElementIds.push("fitem_id_missingconfig"),galleryContainer.classList.toggle("d-none",!0)}toShowElementIds.forEach((function(id){var element=document.getElementById(id);element&&((element,property)=>{element.style.removeProperty(property)})(element,"display")})),toHideElementIds.forEach((function(id){var element=document.getElementById(id);element&&((element,property,value)=>{element.style.setProperty(property,value)})(element,"display","none")}))};sourceElement.addEventListener("change",(event=>{event.preventDefault(),changeVideoConfirm(event,toggleContainerVisibility,SetselectOriginalVale,originalValue)})),videourl.addEventListener("input",(event=>{originalValueUrl&&(event.preventDefault(),changeVideoConfirm(event,changeUrlSave,changeUrlCancel,originalValueUrl))})),toggleContainerVisibility()}}));

//# sourceMappingURL=form.min.js.map