define("mod_videolesson/vplyr",["exports","core/ajax","core/modal_factory","core/modal_events","core/toast","core/str","mod_videolesson/script","mod_videolesson/debug","mod_videolesson/constants"],(function(_exports,_ajax,_modal_factory,_modal_events,Toast,_str,_script,Debug,_constants){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Plyr player functionality for videolesson plugin
   *
   * @module     mod_videolesson/vplyr
   * @copyright  2022-2026 BitKea Technologies LLP
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.cleanup=void 0,_ajax=_interopRequireDefault(_ajax),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),Toast=_interopRequireWildcard(Toast),Debug=_interopRequireWildcard(Debug);let video,mediaElement,videoPlayer,browserData,videoData,chart,percentageEl,playerContainer,playerPlaceholder,completiondetails,tracking=!0,previousTime=0,lastSendTime=0,seekStart=null,playbackRanges=[],existingRanges=[],fromSeek=!1,fromResume=!1,isPlaying=!1,visibilityChangeHandler=null,plyrEventHandlers=[],chartUpdateTimeout=null,lastChartDataHash=null,sendDataRetryCount=0,sendDataQueue=[],storedInitParams=null;const mergeRanges=ranges=>{if(!ranges||!ranges.length)return[];const sorted=ranges.slice().sort(((a,b)=>a[0]-b[0])),merged=[sorted[0].slice()];for(let i=1;i<sorted.length;i++){const current=sorted[i],last=merged[merged.length-1];current[0]<=last[1]?last[1]=Math.max(last[1],current[1]):merged.push(current.slice())}return merged},copyRanges=timeRanges=>{if(!timeRanges||0===timeRanges.length)return[];const copy=[];for(let i=0;i<timeRanges.length;i++)copy.push([timeRanges.start(i),timeRanges.end(i)]);return copy},getPlaybackRangesSnapshot=()=>playbackRanges.map((range=>range.slice())),updateChart=(data,existingRanges)=>{if(!chart||!videoData)return;const vduration=getNormalizedDuration();if(!vduration)return;const dataHash=JSON.stringify(data)+JSON.stringify(existingRanges);if(dataHash===lastChartDataHash)return void updateProgressOnly();lastChartDataHash=dataHash;let opacity=1;data&&data.length>0?opacity=100/data.length/100:existingRanges&&existingRanges.length>0&&(opacity=100/existingRanges.length/100);const fragment=document.createDocumentFragment();let currentRanges;data&&data.length>0&&data.forEach((ranges=>{ranges.forEach((range=>{const div=document.createElement("div"),left=range[0]/vduration*100;let width=range[1]/vduration*100;width-=left,div.style.left="".concat(Math.abs(left),"%"),div.style.width="".concat(Math.abs(width),"%"),div.style.opacity=opacity,fragment.appendChild(div)}))})),chart.innerHTML="",chart.appendChild(fragment),currentRanges=mediaElement&&mediaElement.played&&mediaElement.played.length>0?copyRanges(mediaElement.played):getPlaybackRangesSnapshot(),videoData.watchduration=calculateProgress(vduration,[currentRanges],!1),videoData.ranges=[currentRanges],Debug.log("Watchduration calculated",{ranges:currentRanges,watchduration:videoData.watchduration,duration:vduration,usingNativeAPI:Boolean(mediaElement&&mediaElement.played)}),updateProgressOnly()},getNormalizedDuration=()=>{var _videoPlayer2,_videoData,_video;return(null===(_videoPlayer2=videoPlayer)||void 0===_videoPlayer2?void 0:_videoPlayer2.duration)||(null===(_videoData=videoData)||void 0===_videoData?void 0:_videoData.duration)||(null===(_video=video)||void 0===_video?void 0:_video.duration)||0},isAtEnd=(currentTime,duration)=>{if(!duration||duration<=0)return!1;return currentTime>=duration-.1},updateProgressOnly=()=>{var _video2,_video2$dataset;if(!videoData||!video)return;const normalizedDuration=getNormalizedDuration();if(!normalizedDuration)return;const furthestPoint=Math.max(videoData.max||0,parseFloat((null===(_video2=video)||void 0===_video2||null===(_video2$dataset=_video2.dataset)||void 0===_video2$dataset?void 0:_video2$dataset.maxwatched)||0));if(isAtEnd(furthestPoint,normalizedDuration))return videoData.totalprogess=100,videoData.max=normalizedDuration,void(percentageEl&&(percentageEl.innerText="100%"));const progress=calculateProgressFromFurthest(furthestPoint,normalizedDuration);videoData.totalprogess=progress,videoData.max=furthestPoint,percentageEl&&(percentageEl.innerText="".concat(progress,"%"))},calculateProgress=function(end,nestedRanges){let percentage=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!end||end<=0||!nestedRanges||0===nestedRanges.length)return percentage?"0.00":0;const allRanges=[];if(nestedRanges.forEach((subRanges=>{Array.isArray(subRanges)&&subRanges.forEach((range=>{if(Array.isArray(range)&&range.length>=2){const rangeStart=Math.max(0,Math.round(range[0])),rangeEnd=Math.min(end,Math.round(range[1]));rangeEnd>rangeStart&&allRanges.push([rangeStart,rangeEnd])}}))})),0===allRanges.length)return percentage?"0.00":0;const mergedRanges=mergeRanges(allRanges);let watched=0;if(mergedRanges.forEach((range=>{watched+=range[1]-range[0]})),watched=Math.min(watched,end),!percentage)return watched;const progress=100*watched/end;return progress.toFixed(2)},calculateProgressFromFurthest=(furthestPoint,totalDuration)=>{if(!totalDuration||totalDuration<=0||furthestPoint<0)return 0;if(furthestPoint>=totalDuration-.1)return 100;const progress=Math.min(100,furthestPoint/totalDuration*100);return parseFloat(progress.toFixed(2))},sendDataToServer=function(data){let retry=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!tracking)return!1;if(videoData&&videoData.duration){let currentRanges;mediaElement&&mediaElement.played&&mediaElement.played.length>0?currentRanges=copyRanges(mediaElement.played):playbackRanges.length>0&&(currentRanges=getPlaybackRangesSnapshot()),currentRanges&&currentRanges.length>0&&(data.watchduration=calculateProgress(videoData.duration,[currentRanges],!1),data.ranges=[currentRanges])}sendDataQueue.length>0&&!retry?sendDataQueue.push(data):_ajax.default.call([{methodname:"mod_videolesson_monitor",args:{data:JSON.stringify(data)},done:response=>{if(sendDataRetryCount=0,sendDataQueue.length>0){const nextData=sendDataQueue.shift();sendDataToServer(nextData,!1)}if(!videoData.notified&&response.notify){videoData.notified=!0,Toast.add(response.notify.message,{type:response.notify.type});const badge=document.getElementById("video-progress-requirement");badge&&badge.classList.remove("d-none"),response.activity_info&&completiondetails&&(completiondetails.innerHTML=response.activity_info)}},fail:error=>{sendDataRetryCount++;if(sendDataRetryCount<=3){const delay=1e3*Math.pow(2,sendDataRetryCount-1);Debug.warn("Server call failed, retrying in ".concat(delay,"ms (attempt ").concat(sendDataRetryCount,"/").concat(3,")"),error),setTimeout((()=>{sendDataToServer(data,!0)}),delay)}else Debug.error("Server call failed after max retries",error),sendDataRetryCount=0,sendDataQueue=[]}}])},handleResume=()=>{if(videoData&&videoPlayer){videoData.playbackEvents.push({event_type:"resume",timestamp:(new Date).toISOString(),position:videoData.leftOff});try{playerContainer&&playerContainer.scrollIntoView({behavior:"smooth",block:"center"}),videoPlayer&&videoData.leftOff>=0&&(fromResume=!0,previousTime=videoData.leftOff,videoPlayer.currentTime=videoData.leftOff,videoPlayer.play().catch((error=>{Debug.error("Error playing video on resume",error)})))}catch(error){Debug.error("Error handling resume",error)}}},setupReadyHandler=()=>{const readyHandler=async()=>{Debug.log("Player ready event fired"),await(async()=>{if(videoData&&videoPlayer&&!videoData.duration)if(videoPlayer.duration)videoData.duration=videoPlayer.duration;else if(videoPlayer.embed&&"function"==typeof videoPlayer.embed.getDuration)try{const duration=videoPlayer.embed.getDuration();videoData.duration=duration instanceof Promise?await duration:duration}catch(error){Debug.warn("Error getting embed duration",error)}})(),Debug.log("Media data retrieved",{duration:videoData.duration,hasEmbed:Boolean(videoPlayer.embed)}),sendDataToServer(videoData)};videoPlayer.on("ready",readyHandler),plyrEventHandlers.push({event:"ready",handler:readyHandler})},setupTrackingHandlers=()=>{const timeUpdateHandler=()=>{const newTime=videoPlayer.currentTime||0;if(Math.floor(newTime)%5==0&&newTime-Math.floor(newTime)<.1&&Debug.log("Timeupdate",{currentTime:newTime,duration:videoPlayer.duration,isPlaying:isPlaying,fromSeek:fromSeek,previousTime:previousTime,isEmbed:Boolean(videoPlayer.embed),hasMediaElement:Boolean(mediaElement)}),!isPlaying||fromSeek||fromResume||mediaElement||((start,end)=>{var _videoPlayer;if(!videoData||!videoPlayer)return;if(Number.isNaN(start)||Number.isNaN(end)||start<0||end<0)return;let rangeStart=Math.min(start,end),rangeEnd=Math.max(start,end);if(rangeEnd<=rangeStart)return;const duration=videoData.duration||(null===(_videoPlayer=videoPlayer)||void 0===_videoPlayer?void 0:_videoPlayer.duration)||0;duration>0&&(rangeStart=Math.max(0,Math.min(rangeStart,duration)),rangeEnd=Math.max(0,Math.min(rangeEnd,duration)),rangeEnd<=rangeStart)||(playbackRanges.push([rangeStart,rangeEnd]),playbackRanges=mergeRanges(playbackRanges),playbackRanges.length>_constants.MAX_RANGE_HISTORY&&(playbackRanges=playbackRanges.slice(-_constants.MAX_RANGE_HISTORY)))})(previousTime,newTime),chartUpdateTimeout&&clearTimeout(chartUpdateTimeout),chartUpdateTimeout=setTimeout((()=>{let currentRanges;currentRanges=mediaElement&&mediaElement.played&&mediaElement.played.length>0?copyRanges(mediaElement.played):getPlaybackRangesSnapshot(),updateChart([currentRanges],existingRanges),chartUpdateTimeout=null}),_constants.CHART_UPDATE_DEBOUNCE),fromSeek)return fromSeek=!1,void(previousTime=newTime);if(fromResume&&(fromResume=!1),videoPlayer.playing&&video){const currentMax=parseFloat(video.dataset.maxwatched||0),normalizedDuration=getNormalizedDuration();normalizedDuration>0&&isAtEnd(newTime,normalizedDuration)?(video.dataset.maxwatched=normalizedDuration,videoData.max=normalizedDuration,videoData.totalprogess=100,percentageEl&&(percentageEl.innerText="100%")):newTime>currentMax&&(video.dataset.maxwatched=newTime,updateProgressOnly())}previousTime=newTime,newTime-lastSendTime>=_constants.SEND_INTERVAL&&(Debug.log("Sending data to server (interval)",{currentTime:newTime,lastSendTime:lastSendTime,progress:videoData.totalprogess}),lastSendTime=newTime,sendDataToServer(videoData))};videoPlayer.on("timeupdate",timeUpdateHandler),plyrEventHandlers.push({event:"timeupdate",handler:timeUpdateHandler});const volumeChangeHandler=()=>{videoData.volumeChanges.push({timestamp:(new Date).toISOString(),volume_level:Math.round(100*videoPlayer.volume),position:videoPlayer.currentTime})};videoPlayer.on("volumechange",volumeChangeHandler),plyrEventHandlers.push({event:"volumechange",handler:volumeChangeHandler});const qualityChangeHandler=event=>{videoData.qualityChanges.push({timestamp:(new Date).toISOString(),quality:event.detail.quality,position:videoPlayer.currentTime})};videoPlayer.on("qualitychange",qualityChangeHandler),plyrEventHandlers.push({event:"qualitychange",handler:qualityChangeHandler})},initializeTracking=params=>{if((()=>{if(!tracking)return!1;const initChart=()=>{if(!video)return;let watched=[];try{var _video$dataset;watched=JSON.parse((null===(_video$dataset=video.dataset)||void 0===_video$dataset?void 0:_video$dataset.watchdata)||"[]")}catch(error){watched=[]}0!==watched.length&&(existingRanges=[watched.slice()],updateChart(existingRanges,[]))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initChart):initChart()})(),(async()=>{if(!videoData||!videoData.leftOff)return null;if(videoData.notified)return null;if(videoData.leftOff===videoData.duration)return null;try{const modal=await _modal_factory.default.create({title:(0,_str.get_string)("player:resume:modal:title","mod_videolesson"),body:(0,_str.get_string)("player:resume:modal:body","mod_videolesson"),type:_modal_factory.default.types.SAVE_CANCEL,buttons:{cancel:(0,_str.get_string)("player:resume:modal:no","mod_videolesson"),save:(0,_str.get_string)("player:resume:modal:yes","mod_videolesson")}});modal.getRoot().on(_modal_events.default.save,(()=>{handleResume()})),modal.show()}catch(error){return Debug.error("Error creating resume dialog",error),null}})(),params.max&&video){const serverMax=parseFloat(params.max),currentMax=parseFloat(video.dataset.maxwatched||0);video.dataset.maxwatched=Math.max(serverMax,currentMax),videoData.max=Math.max(serverMax,currentMax)}else video&&(videoData.max=parseFloat(video.dataset.maxwatched||0));visibilityChangeHandler=function(){videoData&&videoPlayer&&(Debug.log("Visibility change",{active:!document.hidden,currentTime:videoPlayer.currentTime}),videoData.visibility.push({timestamp:(new Date).toISOString(),active:!document.hidden,position:videoPlayer.currentTime}))},document.addEventListener("visibilitychange",visibilityChangeHandler),Debug.log("Visibility change handler attached")},setupEventHandlers=()=>{Debug.log("Setting up event listeners"),setupReadyHandler(),(()=>{const playHandler=()=>{Debug.log("Play event fired",{currentTime:videoPlayer.currentTime,duration:videoPlayer.duration,isEmbed:Boolean(videoPlayer.embed),fromResume:fromResume}),isPlaying=!0,videoData.playbackEvents.push({event_type:"play",timestamp:(new Date).toISOString(),position:videoPlayer.currentTime}),fromResume||(previousTime=videoPlayer.currentTime||0),fromSeek?fromSeek=!1:sendDataToServer(videoData)};videoPlayer.on("play",playHandler),plyrEventHandlers.push({event:"play",handler:playHandler});const pauseHandler=()=>{Debug.log("Pause event fired",{currentTime:videoPlayer.currentTime}),isPlaying=!1,fromSeek?fromSeek=!1:(videoData.playbackEvents.push({event_type:"pause",timestamp:(new Date).toISOString(),position:videoPlayer.currentTime}),sendDataToServer(videoData))};videoPlayer.on("pause",pauseHandler),plyrEventHandlers.push({event:"pause",handler:pauseHandler});const endedHandler=()=>{Debug.log("Ended event fired",{currentTime:videoPlayer.currentTime,duration:videoPlayer.duration,videoDataDuration:videoData.duration}),isPlaying=!1,lastSendTime=0;const normalizedDuration=getNormalizedDuration();normalizedDuration>0&&video&&(video.dataset.maxwatched=normalizedDuration,videoData.max=normalizedDuration,videoData.totalprogess=100,percentageEl&&(percentageEl.innerText="100%")),videoData.playbackEvents.push({event_type:"end",timestamp:(new Date).toISOString(),position:normalizedDuration}),sendDataToServer(videoData)};videoPlayer.on("ended",endedHandler),plyrEventHandlers.push({event:"ended",handler:endedHandler})})(),(()=>{const seekingHandler=()=>{Debug.log("Seeking event fired",{currentTime:videoPlayer.currentTime,previousTime:previousTime,fromResume:fromResume}),isPlaying=!1,null===seekStart&&(seekStart=previousTime),fromSeek=!0};videoPlayer.on("seeking",seekingHandler),plyrEventHandlers.push({event:"seeking",handler:seekingHandler});const seekedHandler=()=>{Debug.log("Seeked event fired",{currentTime:videoPlayer.currentTime,seekStart:seekStart,fromResume:fromResume});const seekPosition=videoPlayer.currentTime||0;videoData.seekEvents.push({timestamp:(new Date).toISOString(),start:seekStart,position:seekPosition,progress:seekPosition-seekStart}),video&&seekPosition>parseFloat(video.dataset.maxwatched||0)&&(video.dataset.maxwatched=seekPosition,updateProgressOnly()),previousTime=seekPosition,fromSeek=!1,fromResume=!1,seekStart=null,isPlaying=!videoPlayer.paused};videoPlayer.on("seeked",seekedHandler),plyrEventHandlers.push({event:"seeked",handler:seekedHandler})})(),setupTrackingHandlers(),(()=>{const errorHandler=event=>{Debug.error("Player error event",event);const error=videoPlayer.error||(null==event?void 0:event.detail)||null;if(error){var _ref,_error$code,_ref2,_error$message;const code=null!==(_ref=null!==(_error$code=error.code)&&void 0!==_error$code?_error$code:error.detail)&&void 0!==_ref?_ref:"unknown",message=null!==(_ref2=null!==(_error$message=error.message)&&void 0!==_error$message?_error$message:error.note)&&void 0!==_ref2?_ref2:"Playback error";videoData.errors.push({timestamp:(new Date).toISOString(),error_type:code,error_description:message})}};videoPlayer.on("error",errorHandler),plyrEventHandlers.push({event:"error",handler:errorHandler})})()};_exports.init=params=>{var _video3,_video3$dataset,_video4,_video4$dataset,_video5,_video5$dataset,_video6,_video6$dataset,_video7,_video8,_video9,_video9$classList;storedInitParams=params,Debug.log("vplyr.init called",{params:params}),tracking=params.tracking,null!==params.externaltype&&null!==params.externalvideoid||"external"!==params.source&&"external"!==params.provider||(tracking=!1),video=document.getElementById("player"),mediaElement=video&&"VIDEO"===video.tagName?video:null,browserData=bowser.parse(window.navigator.userAgent),params.video=document.getElementById("player");null===(_video3=video)||void 0===_video3||null===(_video3$dataset=_video3.dataset)||void 0===_video3$dataset||_video3$dataset.source;const sourcedata=(null===(_video4=video)||void 0===_video4||null===(_video4$dataset=_video4.dataset)||void 0===_video4$dataset?void 0:_video4$dataset.sourcedata)||"",subtitlesJson=(null===(_video5=video)||void 0===_video5||null===(_video5$dataset=_video5.dataset)||void 0===_video5$dataset?void 0:_video5$dataset.subtitles)||"[]",title=(null===(_video6=video)||void 0===_video6||null===(_video6$dataset=_video6.dataset)||void 0===_video6$dataset?void 0:_video6$dataset.title)||"";let subtitles=[];try{subtitles=JSON.parse(subtitlesJson)}catch(e){Debug.warn("Error parsing subtitles from data attribute",e)}chart=document.getElementById("videolesson-chart"),percentageEl=document.getElementById("video-progress-total-percentage"),playerContainer=document.getElementById("player-container-div"),playerPlaceholder=document.getElementById("player-placeholder"),completiondetails=document.querySelector('[data-region="activity-information"].activity-information'),Debug.log("Video element found",{tagName:null===(_video7=video)||void 0===_video7?void 0:_video7.tagName,className:null===(_video8=video)||void 0===_video8?void 0:_video8.className,isVideo:Boolean(mediaElement),isEmbed:null===(_video9=video)||void 0===_video9||null===(_video9$classList=_video9.classList)||void 0===_video9$classList?void 0:_video9$classList.contains("plyr__video-embed")});const tracks=subtitles.map(((item,index)=>({kind:"subtitles",language:item.language,code:item.code,url:item.url,...0===index&&{default:!0}})));mediaElement&&(0,_script.addSubtitleTracks)(mediaElement,tracks),videoData={videoid:params.videoid,videotitle:title,source:params.provider,sourcedata:sourcedata,session:params.session,userid:params.userid,cm:params.cm,timestamp:(new Date).toISOString(),duration:params.duration,leftOff:params.leftOff,max:params.max,totalprogess:params.progress,watchduration:0,ranges:[],playbackEvents:[],volumeChanges:[],qualityChanges:[],seekEvents:[],visibility:[],errors:[],city:params.city,country:params.country,ip:params.ip,platform:browserData.platform.type,browser:"".concat(browserData.browser.name,"|v").concat(browserData.browser.version),os:browserData.os.name,notified:params.notified,student:params.student,externaltype:params.externaltype||null,externalvideoid:params.externalvideoid||null},(0,_script.initializePlayer)(params).then((videoPlyr=>{var _videoPlayer$embed;videoPlayer=videoPlyr,Debug.log("Player initialized",{hasPlayer:Boolean(videoPlayer),hasEmbed:Boolean(videoPlayer.embed),embedProvider:null===(_videoPlayer$embed=videoPlayer.embed)||void 0===_videoPlayer$embed?void 0:_videoPlayer$embed.provider,duration:videoPlayer.duration})})).then((()=>{playerContainer&&playerContainer.classList.remove("d-none"),playerPlaceholder&&playerPlaceholder.classList.add("d-none"),setupEventHandlers()})).then((()=>{initializeTracking(params),Debug.log("Initialization complete",{hasPlayer:Boolean(videoPlayer),tracking:tracking,provider:videoData.source})})).catch((error=>{Debug.error("Initialization error",error)}))};const cleanup=()=>{if(videoPlayer&&plyrEventHandlers.length>0&&(plyrEventHandlers.forEach((_ref3=>{let{event:event,handler:handler}=_ref3;try{videoPlayer.off(event,handler)}catch(e){Debug.warn("Error removing Plyr event listener",{event:event,error:e})}})),plyrEventHandlers=[]),videoPlayer){try{videoPlayer.destroy()}catch(e){Debug.warn("Error destroying player",e)}videoPlayer=null}visibilityChangeHandler&&(document.removeEventListener("visibilitychange",visibilityChangeHandler),visibilityChangeHandler=null),chartUpdateTimeout&&(clearTimeout(chartUpdateTimeout),chartUpdateTimeout=null),playbackRanges=[],existingRanges=[],fromSeek=!1,isPlaying=!1,seekStart=null,previousTime=0,lastSendTime=0,lastChartDataHash=null,video=null,mediaElement=null,chart=null,percentageEl=null,playerContainer=null,playerPlaceholder=null,completiondetails=null,videoData=null,"undefined"!=typeof window&&window.videolesson&&(delete window.videolesson.player,delete window.videolesson.hls,0===Object.keys(window.videolesson).length&&delete window.videolesson)};if(_exports.cleanup=cleanup,"undefined"!=typeof window){let isNavigatingAway=!1;window.addEventListener("pageshow",(event=>{if(event.persisted){Debug.log("Page restored from bfcache, checking player state");const playerElement=document.getElementById("player"),playerContainer=document.getElementById("player-container-div");playerElement&&!videoPlayer&&playerContainer&&!playerContainer.classList.contains("d-none")?(Debug.log("Player element exists but not initialized after bfcache restore"),setTimeout((()=>{videoPlayer||(Debug.log("Player still not initialized after delay, reloading page"),window.location.reload())}),500)):playerElement&&videoPlayer&&Debug.log("Player already initialized after bfcache restore")}isNavigatingAway=!1})),window.addEventListener("beforeunload",(event=>{isNavigatingAway=!0,"hidden"===document.visibilityState&&cleanup()})),window.addEventListener("unload",(()=>{isNavigatingAway&&cleanup()}))}}));

//# sourceMappingURL=vplyr.min.js.map