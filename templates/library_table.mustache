{{!
    @template mod_videolesson/library_table

    AJAX-driven video table for the library page.
}}

<div id="videolesson-table-wrapper" class="videolesson-table-wrapper">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="text-muted">
            {{#str}}manage:videos:total, mod_videolesson, {{pagination.total}}{{/str}}
            {{#filters.active}}
            <span class="ml-2 small">
                {{#filters.search}}
                <span class="badge badge-info videolesson-filter-badge" data-filter-type="search">
                    {{#str}}filter:text, mod_videolesson{{/str}}: "{{filters.search}}"
                    <button type="button" class="videolesson-remove-filter ml-1" aria-label="{{#str}}removefilter, mod_videolesson{{/str}}" title="{{#str}}removefilter, mod_videolesson{{/str}}">
                        <i class="icon fa fa-times" aria-hidden="true"></i>
                    </button>
                </span>
                {{/filters.search}}
                {{#filters.foldername}}
                <span class="badge badge-info ml-1 videolesson-filter-badge" data-filter-type="folder">
                    {{#str}}filter:folder, mod_videolesson{{/str}}: "{{filters.foldername}}"
                    <button type="button" class="videolesson-remove-filter ml-1" aria-label="{{#str}}removefilter, mod_videolesson{{/str}}" title="{{#str}}removefilter, mod_videolesson{{/str}}">
                        <i class="icon fa fa-times" aria-hidden="true"></i>
                    </button>
                </span>
                {{/filters.foldername}}
            </span>
            {{/filters.active}}
        </div>
        <div class="videolesson-table-actions">
            <button type="button" class="btn btn-link p-0 videolesson-refresh-table">
                <i class="icon fa fa-sync" aria-hidden="true"></i> {{#str}}refresh, core{{/str}}
            </button>
        </div>
    </div>
    <div id="videolesson-bulk-actions" class="d-none mb-2">
        <button type="button" class="btn btn-primary btn-sm videolesson-bulk-move">
            <i class="icon fa fa-folder-open" aria-hidden="true"></i> {{#str}}bulk:move, mod_videolesson{{/str}}
        </button>
        <button type="button" class="btn btn-danger btn-sm videolesson-bulk-delete">
            <i class="icon fa fa-trash" aria-hidden="true"></i> {{#str}}bulk:delete, mod_videolesson{{/str}}
        </button>
        <span class="ml-2 text-muted" id="videolesson-selected-count">0 {{#str}}bulk:selected_count, mod_videolesson{{/str}}</span>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-hover" id="videolesson-table">
            <thead>
                <tr>
                    <th>&nbsp;</th>
                    <th><input type="checkbox" id="videolesson-select-all" title="{{#str}}bulk:select_all, mod_videolesson{{/str}}" aria-label="{{#str}}bulk:select_all, mod_videolesson{{/str}}"></th>
                    <th class="videolesson-sortable" data-sort-column="title">{{#str}}col_vid_title, mod_videolesson{{/str}} <span class="sort-indicator"></span></th>
                    <th class="videolesson-sortable" data-sort-column="folder">{{#str}}col_folder, mod_videolesson{{/str}} <span class="sort-indicator"></span></th>
                    <th class="videolesson-sortable" data-sort-column="status">{{#str}}col_vid_status, mod_videolesson{{/str}} <span class="sort-indicator"></span></th>
                    <th class="videolesson-sortable" data-sort-column="instances">{{#str}}col_vid_instances, mod_videolesson{{/str}} <span class="sort-indicator"></span></th>
                    <th class="videolesson-sortable" data-sort-column="timecreated">{{#str}}col_timecreated, mod_videolesson{{/str}} <span class="sort-indicator"></span></th>
                    <th>{{#str}}col_action, mod_videolesson{{/str}}</th>
                </tr>
            </thead>
            <tbody>
                {{#hasvideos}}
                    {{#videos}}
                    <tr class="videolesson-draggable-row"
                        data-videolesson-id="{{id}}"
                        data-folder-id="{{#folderid}}{{folderid}}{{/folderid}}{{^folderid}}null{{/folderid}}"
                        data-sort-title="{{title}}"
                        data-sort-folder="{{foldername}}"
                        data-sort-status="{{status}}"
                        data-sort-instances="{{instances}}"
                        data-sort-timecreated="{{timecreatedtimestamp}}">
                        <td class="align-middle text-center">
                            <span class="videolesson-drag-handle" draggable="true"
                                  title="{{#str}}folder:drag_handle, mod_videolesson{{/str}}">
                                <i class="icon fa fa-grip-vertical" aria-hidden="true"></i>
                            </span>
                        </td>
                        <td class="align-middle text-center">
                            <input type="checkbox" class="videolesson-video-checkbox" data-video-id="{{id}}" data-contenthash="{{contenthash}}" aria-label="{{#str}}bulk:select_video, mod_videolesson{{/str}}">
                        </td>
                        <td style="min-width: 400px;">
                            <div class="d-flex align-items-center">
                                {{#viewaction}}
                                    <img src="{{thumbnail}}"
                                         class="mr-2 rounded videolesson-viewmodal-thumbnail"
                                         alt=""
                                         width="90"
                                         height="50"
                                         data-videolesson-src="{{src}}"
                                         data-videolesson-contenthash="{{contenthash}}"
                                         data-videolesson-title="{{title}}"
                                         onerror="this.onerror=null; this.src='{{placeholder}}';">
                                {{/viewaction}}
                                {{^viewaction}}
                                    <img src="{{thumbnail}}"
                                         class="mr-2 rounded"
                                         alt=""
                                         width="90"
                                         height="50"
                                         onerror="this.onerror=null; this.src='{{placeholder}}';">
                                {{/viewaction}}
                                <div>
                                    {{{namehtml}}}
                                    <div class="small text-muted">{{duration}}</div>
                                    <div class="small text-muted">{{#str}}col_vid_size, mod_videolesson{{/str}} : {{size}}</div>
                                    <div class="small text-muted">{{#str}}col_vid_source_size, mod_videolesson{{/str}} : {{sourcesize}}</div>
                                </div>
                            </div>
                        </td>
                        <td><span class="videolesson-folder-name">{{foldername}}</span></td>
                        <td>
                            {{#status}}
                                <span class="badge badge-{{statusbadge}}">{{status}}</span>
                            {{/status}}
                        </td>
                        <td>
                            {{#instancesurl}}
                                <a href="{{instancesurl}}" target="_blank">{{instances}}</a>
                            {{/instancesurl}}
                            {{^instancesurl}}
                                {{instances}}
                            {{/instancesurl}}
                        </td>
                        <td>{{timecreated}}</td>
                        <td>
                            <div class="video-actions-container">
                                <span class="video-actions-indicator">
                                    <i class="icon fa fa-ellipsis-v" aria-hidden="true"></i>
                                </span>
                                <div class="video-actions">
                                    {{#viewaction}}
                                        <button type="button"
                                            class="btn btn-sm btn-link videolesson-viewmodal-data"
                                            data-videolesson-src="{{src}}"
                                            data-videolesson-contenthash="{{contenthash}}"
                                            data-videolesson-title="{{title}}"
                                            title="{{#str}}view, moodle{{/str}}">
                                            <i class="icon fa fa-play" aria-hidden="true"></i>
                                        </button>
                                    {{/viewaction}}
                                    {{#mp4action}}
                                        <a href="{{url}}" class="btn btn-sm btn-link" target="_blank" title="{{#str}}manage:video:mp4, mod_videolesson{{/str}}">
                                            <i class="icon fa fa-download" aria-hidden="true"></i>
                                        </a>
                                    {{/mp4action}}
                                    {{#assignable}}
                                        <button type="button"
                                            class="btn btn-sm btn-link videolesson-assign-folder"
                                            data-videolesson-id="{{id}}"
                                            data-current-folder="{{#folderid}}{{folderid}}{{/folderid}}{{^folderid}}null{{/folderid}}"
                                            data-video-title="{{title}}"
                                            title="{{#str}}folder:assign, mod_videolesson{{/str}}">
                                            <i class="icon fa fa-folder-open" aria-hidden="true"></i>
                                        </button>
                                    {{/assignable}}
                                    {{#cansubtitle}}
                                        <button type="button"
                                            class="btn btn-sm btn-link videolesson-trigger-subtitle"
                                            data-contenthash="{{contenthash}}"
                                            data-video-name="{{title}}"
                                            title="{{#str}}subtitle:generate, mod_videolesson{{/str}}">
                                            <i class="icon fa fa-closed-captioning" aria-hidden="true"></i>
                                        </button>
                                    {{/cansubtitle}}
                                    <a href="{{reporturl}}" class="btn btn-sm btn-link" target="_blank" title="{{#str}}report, mod_videolesson{{/str}}">
                                        <i class="icon fa fa-chart-line" aria-hidden="true"></i>
                                    </a>
                                    {{#retryurl}}
                                        <a href="{{retryurl}}" class="btn btn-sm btn-link" title="{{#str}}manage:video:upload:retry, mod_videolesson{{/str}}">
                                            <i class="icon fa fa-redo" aria-hidden="true"></i>
                                        </a>
                                    {{/retryurl}}
                                    <a href="{{deleteurl}}" class="btn btn-sm btn-link text-danger videolesson-delete-link"
                                       data-video-id="{{id}}"
                                       data-contenthash="{{contenthash}}"
                                       data-video-name="{{title}}"
                                       title="{{#str}}delete, moodle{{/str}}">
                                        <i class="icon fa fa-trash" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {{/videos}}
                {{/hasvideos}}
                {{^hasvideos}}
                    <tr>
                        <td colspan="9" class="text-center text-muted py-4">
                            {{#str}}nothingtodisplay, moodle{{/str}}
                        </td>
                    </tr>
                {{/hasvideos}}
            </tbody>
        </table>
    </div>

    {{#pagination.haspages}}
    <nav aria-label="Video pagination" class="mt-3">
        <ul class="pagination">
            <li class="page-item {{^pagination.hasprev}}disabled{{/pagination.hasprev}}">
                <a class="page-link videolesson-page-link" href="#" data-page="{{pagination.prevpage}}">&laquo;</a>
            </li>
            {{#pagination.pages}}
                <li class="page-item {{#current}}active{{/current}}">
                    <a class="page-link videolesson-page-link" href="#" data-page="{{number}}">{{display}}</a>
                </li>
            {{/pagination.pages}}
            <li class="page-item {{^pagination.hasnext}}disabled{{/pagination.hasnext}}">
                <a class="page-link videolesson-page-link" href="#" data-page="{{pagination.nextpage}}">&raquo;</a>
            </li>
        </ul>
    </nav>
    {{/pagination.haspages}}
</div>

