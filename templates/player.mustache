{{!
  This file is part of Moodle - http://moodle.org/

  Moodle is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  Moodle is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}

{{#cssfiles}}
<link rel="stylesheet" href="{{{.}}}">
{{/cssfiles}}
<div class="mod-videolesson-box">

  <div id="player-placeholder">
    <div class="bg-pulse-grey my-2" style="height: 200px;width: 100%; border-radius: 10px;"></div>
    <div class="bg-pulse-grey my-2" style="height: 20px;width: 80%;"></div>
  </div>

  <div id="player-container-div" class="d-none">
    {{#aws}}
    <!-- aws -->
    <video id="player"
           data-watchdata="{{{watchdata}}}"
           data-source="{{{data_attributes.sourceurl}}}"
           data-sourcedata="{{{data_attributes.sourcedata}}}"
           data-subtitles="{{{data_attributes.subtitles}}}"
           data-title="{{{data_attributes.title}}}"
           playsinline controls
           {{#data_attributes.poster}}data-poster="{{{data_attributes.poster}}}"{{/data_attributes.poster}}>
    </video>
    {{/aws}}

    {{#external}}
        {{#external_embed}}
        {{#unsupported_embed}}
        <!-- Unsupported embed provider - output iframe directly without Plyr tracking -->
        <div id="player" class="plyr__video-embed"
             data-watchdata="{{{watchdata}}}"
             data-source="{{{data_attributes.sourceurl}}}"
             data-sourcedata="{{{data_attributes.sourcedata}}}"
             data-subtitles="{{{data_attributes.subtitles}}}"
             data-title="{{{data_attributes.title}}}">
            {{{unsupported_embed_html}}}
        </div>
        {{/unsupported_embed}}
        {{^unsupported_embed}}
        <!-- Plyr will enhance the iframe for tracking (YouTube/Vimeo) -->
        <div id="player"
             class="plyr__video-embed"
             {{#externaltype}}data-plyr-provider="{{externaltype}}"{{/externaltype}}
             {{#externalvideoid}}data-plyr-embed-id="{{externalvideoid}}"{{/externalvideoid}}
             data-watchdata="{{{watchdata}}}"
             data-source="{{{data_attributes.sourceurl}}}"
             data-sourcedata="{{{data_attributes.sourcedata}}}"
             data-subtitles="{{{data_attributes.subtitles}}}"
             data-title="{{{data_attributes.title}}}"
             {{#externaltype}}data-provider="{{externaltype}}"{{/externaltype}}
             {{#externalvideoid}}data-embed-id="{{externalvideoid}}"{{/externalvideoid}}>
            <iframe
                src="{{externalembedurl}}"
                allowfullscreen
                allow="autoplay; encrypted-media"
                frameborder="0">
            </iframe>
        </div>
        {{/unsupported_embed}}
        {{/external_embed}}
        {{#external_file}}
        <video id="player"
               data-watchdata="{{{watchdata}}}"
               data-source="{{{data_attributes.sourceurl}}}"
               data-sourcedata="{{{data_attributes.sourcedata}}}"
               data-subtitles="{{{data_attributes.subtitles}}}"
               data-title="{{{data_attributes.title}}}"
               controls
               crossorigin
               playsinline
               {{#data_attributes.poster}}poster="{{data_attributes.poster}}"{{/data_attributes.poster}}>
            <source src="{{{data_attributes.sourcedata}}}" type="{{data_attributes.type}}">
        </video>
        {{/external_file}}
    {{/external}}

    {{#chart}}
    <div id="mod-videolesson-chart-container" {{^showchart}}class="d-none"{{/showchart}}>
      <p class="mb-0"><span>{{#str}}player:progress, mod_videolesson{{/str}}</span> <span id="video-progress-total-percentage"></span> <i id="video-progress-requirement" title="{{#str}}player:progress:reached, mod_videolesson{{/str}}" class="fa fa-check-circle {{#incomplete}}d-none{{/incomplete}}" style="color: #37ae4b;"></i></p>
      <div id="videolesson-chart" class="mod-videolesson-chart m-auto d-none" style="max-width: 900px;"></div>
    </div>
    {{/chart}}
  </div>
</div>

{{#jsfiles}}
<script src="{{{.}}}"></script>
{{/jsfiles}}
{{#external_requires_youtube}}
<script src="https://www.youtube.com/iframe_api"></script>
{{/external_requires_youtube}}
{{#external_requires_vimeo}}
<script src="https://player.vimeo.com/api/player.js"></script>
{{/external_requires_vimeo}}
